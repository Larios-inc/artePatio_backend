// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


//  ----------------- HERE WE ARE SETTING THE MODELS FOR OUR PRODUCTS ----------------

model Product {
  idProduct        String @unique
  name_Product     String @unique
  price            Int @default(0)
  created_At       DateTime @default(now())
  img_Main_Product String?
  description      DescriptionProduct[]
  category         Category[]
  orderItems       OrderItems[]
  monthlySale      MonthlySale[]
  topSale          TopSale[]

  @@id([idProduct])
}

model DescriptionProduct{
  idDescription   String @unique
  desc            String
  desc_1          String?
  stock           Int @default(0)
  descImg         descImg @relation(fields: [descImgId], references: [idDescImg])
  descImgId       String
  product         Product @relation(fields: [productId], references: [idProduct])
  productId       String

  @@id([idDescription, descImgId, productId])
}
 
model descImg{
  idDescImg String @unique
  imgs      String?
  product   DescriptionProduct [] 

  @@id([idDescImg])
}

model Category {
  idCategory   String @unique
  categoryName String @unique
  createAt     DateTime @default(now())
  product      Product @relation(fields: [productId], references: [idProduct])
  productId     String

  @@id([idCategory, productId])
}

//  ----------------- HERE WE ARE SETTING THE MODELS FOR OUR ORDERS ---------------

model Orders {
  idOrders    String @unique
  id          Int @unique @default(autoincrement())
  order_Date  DateTime @default(now())
  total_amout Decimal @db.Decimal(10, 2)
  status      String
  user        User @relation(fields: [userId], references: [idUser])
  userId      String
  order_Items OrderItems[]

  @@id([idOrders,id, userId])
}

model OrderItems {
  idOrderItems   String @unique
  quiantity      Int
  price          Decimal @db.Decimal(10, 2)
  order          Orders @relation(fields: [orderId], references: [idOrders])
  orderId        String
  product        Product @relation(fields: [productId], references: [idProduct])
  productId      String

  @@id([idOrderItems, orderId, productId])
}

//  ----------------- HERE WE ARE SETTING THE MODELS FOR OUR USERS ----------------

model User {
  idUser             String @unique
  username           String @unique
  email              String @unique
  password           String
  created_At         DateTime @default(now())
  is_Active          Boolean @default(true)
  role               Role @relation(fields: [roleId], references: [idRole])
  roleId             String
  contactInformation ContactInformation? @relation(fields: [contactInfo_Id], references: [idContact])
  contactInfo_Id     String?
  orders             Orders[]
  monthlySale        MonthlySale[]
  topSale            TopSale[]

  @@id([idUser, username, email, roleId])
}

model ContactInformation {
  idContact     String @unique
  name          String 
  last_Name     String?
  address       Address @relation(fields: [addressId], references: [idAddress])
  addressId     String
  phoneNumber   PhoneNumber @relation(fields: [phoneNumberid], references: [idPhoneNumber])
  phoneNumberid String
  user          User[]

  @@id([idContact, addressId, phoneNumberid])
}

model PhoneNumber {
  idPhoneNumber String @unique
  phone_number  Int @unique
  contact_information ContactInformation[]

  @@id([idPhoneNumber])
}

model Address {
  idAddress      String @unique
  address_line_1 String
  address_line_2 String?
  address_line_3 String?
  city           String
  type_state     typeState @relation(fields: [stateId], references: [idTypeState])
  stateId        String
  zip_code       Int
  contact_information ContactInformation[]

  @@id([idAddress, stateId])
}

model typeState {
  idTypeState         String @unique
  type_state          String @unique
  address Address[]
}

model Role{
  idRole    String @unique
  role_Name  String @unique
  create_At  DateTime @default(now())
  user      User[]
}

//  ----------------- HERE WE ARE SETTING THE MODELS FOR TOP SALES ----------------

model MonthlySale {
  idMonthSale    String @unique
  month          String
  dateTime       DateTime 
  customer       User @relation(fields: [customer_id], references: [idUser])
  customer_id    String
  product        Product @relation(fields: [product_name], references: [name_Product])
  product_name   String
  revenue        Decimal @db.Decimal(10,2)
  revenue_rank   Int

  @@id([idMonthSale, customer_id, product_name])
}

model TopSale {
  idTopSale      String @unique
  month          DateTime
  customer       User @relation(fields: [customer_id], references: [idUser])
  customer_id    String
  product        Product @relation(fields: [product_name], references: [name_Product])
  product_name   String
  revenue        Decimal
  revenue_rank   Int

  @@id([idTopSale, customer_id,product_name])
}